import{a as D}from"./chunk-SUZLID75.js";import{a as B,b as A}from"./chunk-Z2VXY6A4.js";import{a as z,b as N}from"./chunk-O3ILVNDL.js";import{a as I,b as w,c as L,d as T,f as y,h as R,i as M,n as x,p as V}from"./chunk-DTJY53OX.js";import{a as G}from"./chunk-HP2GQHZV.js";import{e as P,h as F}from"./chunk-V4HT3JDP.js";import{Ab as r,Bb as b,Ja as a,Oa as f,Ua as k,Za as h,eb as l,gb as v,gc as S,ia as u,ja as g,kb as t,lb as o,mb as m,mc as E,pa as C,qb as _,rb as p,sb as d}from"./chunk-GPF5BPB6.js";function W(n,i){n&1&&(t(0,"p",24),r(1," Obavezno "),o())}function q(n,i){n&1&&(t(0,"p",25),r(1," \xA0 "),o())}function U(n,i){n&1&&(t(0,"p",24),r(1," Obavezno "),o())}function Y(n,i){n&1&&(t(0,"p",25),r(1," \xA0 "),o())}function $(n,i){if(n&1&&(t(0,"div",4)(1,"button",26),r(2,"Prijavi se"),o()()),n&2){let s=d();a(),l("disabled",s.loginForm.invalid)}}function Z(n,i){if(n&1){let s=_();t(0,"div",27),r(1," Wrong Password "),m(2,"br"),t(3,"button",28),p("accessibleClick",function(){u(s);let c=d();return g(c.openForgotPasswordModal())}),r(4," Zaboravili ste lozinku? "),o()()}}function H(n,i){if(n&1){let s=_();t(0,"div",4)(1,"button",22),p("accessibleClick",function(){u(s);let c=d();return g(c.resendVerification())}),r(2," Ponovno po\u0161alji verifikacijski link "),o()()}}function J(n,i){if(n&1&&(t(0,"p",29),r(1),o()),n&2){let s=d();a(),b(s.successMessage)}}function K(n,i){if(n&1&&(t(0,"p",24),r(1),o()),n&2){let s=d();a(),b(s.errorMessage)}}function Q(n,i){if(n&1){let s=_();t(0,"div",30)(1,"span"),r(2,"Nemate ra\u010Dun?"),o(),t(3,"a",31),p("accessibleClick",function(){u(s);let c=d();return g(c.switchToRegister())}),r(4," Register "),o()()}}function X(n,i){if(n&1){let s=_();t(0,"app-reset-password",32),p("close",function(){u(s);let c=d();return g(c.onCloseResetModal())}),o()}}var j=class n{constructor(i,s,e,c){this.fb=i;this.authService=s;this.router=e;this.snackBar=c;this.loginForm=this.fb.group({identifier:["",w.required],password:["",w.required]})}closed=new C;loginForm;ngOnInit(){console.log("\u2705 LoginComponent inicijaliziran!")}submitted=!1;showPassword=!1;successMessage="";errorMessage="";showResend=!1;unverifiedUserId="";showRegisterSuggestion=!1;loginFailed=!1;hide=!0;showResetPasswordModal=!1;onLogin(){this.submitted=!0,!this.loginForm.invalid&&this.authService.login(this.loginForm.value).subscribe({next:i=>{console.log("Login response:",i),localStorage.setItem("token",i.token),this.snackBar.open("Successful login","",{duration:3e3,horizontalPosition:"right",verticalPosition:"bottom",panelClass:"success-snackbar"}),this.loginFailed=!1,this.router.navigate(["/"]),this.authService.setAuthState(!0),this.authService.setUser(i.user),this.close()},error:i=>{i.status===403?(this.errorMessage=`Your account (${this.loginForm.value.email}) is not confirmed`,this.unverifiedUserId=i.error.userId,this.showResend=!0,this.snackBar.open(`Your account (${this.loginForm.value.email}) is not confirmed`,"",{duration:5e3,horizontalPosition:"right",verticalPosition:"bottom",panelClass:"error-snackbar"})):i.status===401?(this.loginFailed=!0,this.showRegisterSuggestion=!0,this.snackBar.open("Incorrect password","",{duration:5e3,horizontalPosition:"right",verticalPosition:"bottom",panelClass:"error-snackbar"})):i.status===404?(this.errorMessage="The user does not exist",this.showRegisterSuggestion=!0,this.snackBar.open("The user does not exist","",{duration:5e3,horizontalPosition:"right",verticalPosition:"bottom",panelClass:"error-snackbar"})):(this.errorMessage="Incorrect data",this.showResend=!1,this.showRegisterSuggestion=!1)}})}get identifier(){return this.loginForm.get("identifier")}get password(){return this.loginForm.get("password")}close(){console.log("\u{1F525} zatvaram modal"),this.closed.emit()}togglePasswordVisibility(){this.showPassword=!this.showPassword}loginWithGoogle(){this.authService.loginWithGoogle()}loginWithFacebook(){this.authService.loginWithFacebook()}togglePassword(){this.showPassword=!this.showPassword}get f(){return this.loginForm.controls}switchToRegister(){this.close();let i=new CustomEvent("switchToRegister");window.dispatchEvent(i)}resendVerification(){let i=this.loginForm.value.identifier;if(!i){this.snackBar.open("Email not entered","",{duration:3e3});return}this.authService.resendVerificationEmail(i).subscribe({next:()=>{this.snackBar.open("Verification email sent","",{duration:5e3,horizontalPosition:"right",verticalPosition:"bottom",panelClass:"success-snackbar"}),this.showResend=!1,this.close()},error:()=>{this.snackBar.open(this.errorMessage,"",{duration:5e3,horizontalPosition:"right",verticalPosition:"bottom",panelClass:"error-snackbar"})}})}onCloseResetModal(){this.showResetPasswordModal=!1}openForgotPasswordModal(){let i=this.loginForm.value.identifier;if(alert(i),!i){this.snackBar.open("Enter your email to reset your password","",{duration:3e3});return}this.authService.sendResetPasswordEmail(i).subscribe({next:()=>{this.snackBar.open("Reset link sent to your email","",{duration:5e3,horizontalPosition:"right",verticalPosition:"bottom",panelClass:"success-snackbar"})},error:()=>{this.snackBar.open("Error sending reset link","",{duration:5e3,horizontalPosition:"right",verticalPosition:"bottom",panelClass:"error-snackbar"})}})}static \u0275fac=function(s){return new(s||n)(f(x),f(G),f(P),f(B))};static \u0275cmp=k({type:n,selectors:[["app-login"]],outputs:{closed:"closed"},decls:39,vars:18,consts:[["appAccessibleClick","",1,"modal-backdrop",3,"accessibleClick"],["appTrapFocus","",1,"modal-content",3,"click","onEscape"],["appAccessibleClick","",1,"close-button",3,"accessibleClick"],[3,"ngSubmit","formGroup"],[1,"text-center"],[1,"form-row"],["for","identifier"],["id","identifier","formControlName","identifier","placeholder","username or email"],[1,"error-placeholder"],["class","error",4,"ngIf"],["class","error invisible",4,"ngIf"],["for","password"],[1,"password-wrapper"],["id","password","formControlName","password","placeholder","password",1,"password-input",3,"type"],["type","button","appAccessibleClick","",1,"toggle-password",3,"accessibleClick"],[1,"fa","fa-eye"],["class","text-center",4,"ngIf"],["class","error text-center mt-3",4,"ngIf"],["class","success",4,"ngIf"],["class","mt-4 text-center",4,"ngIf"],[1,"text-center","social-login","mt-4"],[1,"text-sm","mb-2"],["type","button","appAccessibleClick","",1,"link-button",3,"accessibleClick"],["class","link-button",3,"close",4,"ngIf"],[1,"error"],[1,"error","invisible"],["type","submit",3,"disabled"],[1,"error","text-center","mt-3"],["type","submit","appAccessibleClick","",3,"accessibleClick"],[1,"success"],[1,"mt-4","text-center"],["href","#","appAccessibleClick","",1,"text-blue-600","hover:underline",3,"accessibleClick"],[1,"link-button",3,"close"]],template:function(s,e){s&1&&(t(0,"div",0),p("accessibleClick",function(){return e.close()}),t(1,"div",1),p("click",function(O){return O.stopPropagation()}),t(2,"button",2),p("accessibleClick",function(){return e.close()}),r(3,"\xD7"),o(),t(4,"form",3),p("ngSubmit",function(){return e.onLogin()}),t(5,"h4",4),r(6,"Login"),o(),m(7,"br"),t(8,"div",5)(9,"label",6),r(10,"Email or Username:"),o(),m(11,"input",7),t(12,"div",8),h(13,W,2,0,"p",9)(14,q,2,0,"p",10),o()(),t(15,"div",5)(16,"label",11),r(17,"Password:"),o(),t(18,"div",12),m(19,"input",13),t(20,"button",14),p("accessibleClick",function(){return e.togglePassword()}),m(21,"i",15),o()(),t(22,"div",8),h(23,U,2,0,"p",9)(24,Y,2,0,"p",10),o()(),h(25,$,3,1,"div",16)(26,Z,5,0,"div",17)(27,H,3,0,"div",16)(28,J,2,1,"p",18)(29,K,2,1,"p",9)(30,Q,5,0,"div",19),t(31,"div",20)(32,"p",21),r(33,"Or Login Using:"),o(),t(34,"button",22),p("accessibleClick",function(){return e.loginWithGoogle()}),r(35,"Google"),o(),t(36,"button",22),p("accessibleClick",function(){return e.loginWithFacebook()}),r(37,"Facebook"),o()()(),h(38,X,1,0,"app-reset-password",23),o()()),s&2&&(a(),l("onEscape",e.close),a(3),l("formGroup",e.loginForm),a(7),v("invalid",(e.identifier==null?null:e.identifier.invalid)&&((e.identifier==null?null:e.identifier.touched)||e.submitted)),a(2),l("ngIf",(e.identifier==null?null:e.identifier.hasError("required"))&&((e.identifier==null?null:e.identifier.touched)||e.submitted)),a(),l("ngIf",!(e.identifier!=null&&e.identifier.hasError("required"))||!(e.identifier!=null&&e.identifier.touched||e.submitted)),a(5),v("invalid",(e.password==null?null:e.password.invalid)&&((e.password==null?null:e.password.touched)||e.submitted)),l("type",e.showPassword?"text":"password"),a(4),l("ngIf",(e.password==null?null:e.password.hasError("required"))&&((e.password==null?null:e.password.touched)||e.submitted)),a(),l("ngIf",!(e.password!=null&&e.password.hasError("required"))||!(e.password!=null&&e.password.touched||e.submitted)),a(),l("ngIf",!e.showResend),a(),l("ngIf",e.loginFailed),a(),l("ngIf",e.showResend),a(),l("ngIf",e.successMessage),a(),l("ngIf",e.errorMessage),a(),l("ngIf",!e.loginFailed&&e.showRegisterSuggestion),a(8),l("ngIf",e.showResetPasswordModal))},dependencies:[E,S,V,y,I,L,T,R,M,A,F,D,N,z],encapsulation:2})};export{j as a};
