import{b as re,d as le}from"./chunk-VIPQAVYR.js";import"./chunk-ATBZJWYU.js";import"./chunk-SUZLID75.js";import"./chunk-54DFDRU5.js";import"./chunk-Z2VXY6A4.js";import{a as oe,b as se}from"./chunk-O3ILVNDL.js";import{a as ae}from"./chunk-ZCX7W3PH.js";import{a as ee,c as te,e as ne,g as ie,o as V}from"./chunk-DTJY53OX.js";import"./chunk-HP2GQHZV.js";import{a as P}from"./chunk-DJ4ZLQE5.js";import"./chunk-V4HT3JDP.js";import{a as Z}from"./chunk-M6G75PQQ.js";import{Ab as c,Bb as F,Cb as T,Eb as w,Fb as M,Gb as O,Ia as U,Ja as s,Lb as X,Nb as G,Oa as C,Ua as E,Y as H,Za as v,ba as W,eb as m,fc as k,gc as L,ha as j,ia as p,ib as z,ja as h,kb as r,kc as J,lb as o,mb as g,mc as A,p as B,pa as I,qb as D,rb as f,sb as u,vb as Q,wb as K,xb as Y,yb as q}from"./chunk-GPF5BPB6.js";function he(l,e){if(l&1){let t=D();r(0,"div",16)(1,"label",17)(2,"input",18),O("ngModelChange",function(i){p(t);let a=u();return M(a.selectedDateOption,i)||(a.selectedDateOption=i),h(i)}),f("change",function(){p(t);let i=u();return h(i.onDateOptionChange())})("click",function(){let i=p(t).$implicit,a=u();return h(a.onForceOptionChange(i.value))}),o(),c(3),o()()}if(l&2){let t=e.$implicit,n=u();s(),m("for","option-"+t.value),s(),Q("id","option-",t.value,""),m("value",t.value),w("ngModel",n.selectedDateOption),s(),T(" ",t.label," ")}}function fe(l,e){if(l&1){let t=D();r(0,"div",19)(1,"label",20),c(2,"From:"),o(),r(3,"input",21),O("ngModelChange",function(i){p(t);let a=u();return M(a.customFromDate,i)||(a.customFromDate=i),h(i)}),o(),r(4,"label",22),c(5,"To:"),o(),r(6,"input",23),O("ngModelChange",function(i){p(t);let a=u();return M(a.customToDate,i)||(a.customToDate=i),h(i)}),o()()}if(l&2){let t=u();s(3),w("ngModel",t.customFromDate),s(3),w("ngModel",t.customToDate)}}function ve(l,e){if(l&1){let t=D();r(0,"div",24)(1,"input",25),f("change",function(){let i=p(t).$implicit,a=u();return h(a.toggleSurface(i._id))}),o(),r(2,"label",26),c(3),o()()}if(l&2){let t=e.$implicit,n=u();s(),m("id","surface-"+t._id)("checked",n.selectedSurfaceIds.includes(t._id)),s(),m("for","surface-"+t._id),s(),T(" ",t.surface," ")}}function ge(l,e){if(l&1){let t=D();r(0,"div",24)(1,"input",25),f("change",function(){let i=p(t).$implicit,a=u();return h(a.toggleTournamentType(i._id))}),o(),r(2,"label",26),c(3),o()()}if(l&2){let t=e.$implicit,n=u();s(),m("id","tournamentType-"+t._id)("checked",n.selectedTournamentTypeIds.includes(t._id)),s(),m("for","tournamentType-"+t._id),s(),T(" ",t.type," ")}}function De(l,e){if(l&1){let t=D();r(0,"div",24)(1,"input",25),f("change",function(){let i=p(t).$implicit,a=u();return h(a.toggleTournamentLevel(i._id))}),o(),r(2,"label",26),c(3),o()()}if(l&2){let t=e.$implicit,n=u();s(),m("id","tournamentLevel-"+t._id)("checked",n.selectedTournamentLevelIds.includes(t._id)),s(),m("for","tournamentLevel-"+t._id),s(),T(" ",t.level," ")}}var R=class l{closed=new I;filterApplied=new I;resetFilter=new I;surfaceFilterChanged=new I;tournamentTypeFilterChanged=new I;tournamentLevelFilterChanged=new I;activeDateFilter="all";activeFromDate=null;activeToDate=null;activeSurfaceIds=[];activeTournamentTypeIds=[];activeTournamentLevelIds=[];minDate;maxDate;dateOptions=[{label:"All matches",value:"all"},{label:"Last year",value:"year"},{label:"Last month",value:"month"},{label:"Last week",value:"week"},{label:"Custom date range",value:"custom"}];surfaces=[{_id:1,surface:"Indoors"},{_id:2,surface:"Clay"},{_id:3,surface:"Grass"},{_id:4,surface:"Hard"}];tournamentTypes=[{_id:2,type:"ATP"},{_id:4,type:"WTA"}];tournamentLevels=[{_id:1,level:"> 50,000$"},{_id:2,level:"Cup"},{_id:3,level:"Qualifications"},{_id:4,level:"< 50,000$"}];selectedDateOption="all";selectedSurfaceIds=[];selectedTournamentTypeIds=[];selectedTournamentLevelIds=[];customFromDate=null;customToDate=null;ngOnChanges(e){e.activeDateFilter&&(this.selectedDateOption=this.activeDateFilter),this.activeDateFilter==="custom"?(this.customFromDate=this.activeFromDate,this.customToDate=this.activeToDate):(this.customFromDate=null,this.customToDate=null),e.activeSurfaceIds&&(this.selectedSurfaceIds=[...this.activeSurfaceIds]),(!this.selectedSurfaceIds||this.selectedSurfaceIds.length===0)&&(this.selectedSurfaceIds=[1,2,3,4]),e.activeTournamentTypeIds&&(this.selectedTournamentTypeIds=[...this.activeTournamentTypeIds]),(!this.selectedTournamentTypeIds||this.selectedTournamentTypeIds.length===0)&&(this.selectedTournamentTypeIds=[2,4]),e.activeTournamentLevelIds&&(this.selectedTournamentLevelIds=[...this.activeTournamentLevelIds]),(!this.selectedTournamentLevelIds||this.selectedTournamentLevelIds.length===0)&&(this.selectedTournamentLevelIds=[1,2,3,4])}onDateOptionChange(){this.selectedDateOption!=="custom"&&(this.customFromDate=null,this.customToDate=null)}onForceOptionChange(e){this.selectedDateOption===e&&this.onDateOptionChange()}calculateStartDate(e){let t=new Date;switch(e){case"year":t.setFullYear(t.getFullYear()-1);break;case"month":t.setMonth(t.getMonth()-1);break;case"week":t.setDate(t.getDate()-7);break;case"all":default:return null}return t.toISOString().split("T")[0]}close(){this.closed.emit()}apply(){let e={option:this.selectedDateOption,startDate:this.selectedDateOption==="custom"?this.customFromDate:this.calculateStartDate(this.selectedDateOption),endDate:this.selectedDateOption==="custom"?this.customToDate:new Date().toISOString().split("T")[0],surfaceIds:[...this.selectedSurfaceIds],tournamentTypeIds:[...this.selectedTournamentTypeIds],tournamentLevelIds:[...this.selectedTournamentLevelIds]};console.log("\u{1F4E4} Emitting filter from modal:",e),this.filterApplied.emit(e)}toggleSurface(e){let t=this.selectedSurfaceIds.indexOf(e);t>-1?this.selectedSurfaceIds.splice(t,1):this.selectedSurfaceIds.push(e)}toggleTournamentType(e){let t=this.selectedTournamentTypeIds.indexOf(e);t>-1?this.selectedTournamentTypeIds.splice(t,1):this.selectedTournamentTypeIds.push(e)}toggleTournamentLevel(e){let t=this.selectedTournamentLevelIds.indexOf(e);t>-1?this.selectedTournamentLevelIds.splice(t,1):this.selectedTournamentLevelIds.push(e)}reset(){this.selectedDateOption="all",this.customFromDate=null,this.customToDate=null,this.selectedSurfaceIds=[1,2,3,4],this.selectedTournamentTypeIds=[2,4],this.selectedTournamentLevelIds=[1,2,3,4],this.resetFilter.emit()}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=E({type:l,selectors:[["app-tournament-filter-modal"]],inputs:{activeDateFilter:"activeDateFilter",activeFromDate:"activeFromDate",activeToDate:"activeToDate",activeSurfaceIds:"activeSurfaceIds",activeTournamentTypeIds:"activeTournamentTypeIds",activeTournamentLevelIds:"activeTournamentLevelIds",minDate:"minDate",maxDate:"maxDate"},outputs:{closed:"closed",filterApplied:"filterApplied",resetFilter:"resetFilter",surfaceFilterChanged:"surfaceFilterChanged",tournamentTypeFilterChanged:"tournamentTypeFilterChanged",tournamentLevelFilterChanged:"tournamentLevelFilterChanged"},features:[j],decls:36,vars:6,consts:[["appAccessibleClick","",1,"modal-backdrop",3,"accessibleClick"],["appTrapFocus","",1,"modal-content",3,"click","onEscape"],["appAccessibleClick","",1,"close-button",3,"accessibleClick"],[1,"text-center"],[1,"modal-body"],[1,"text-start"],[1,"form-label","fw-bold","mb-1"],["class","form-check filter-radio-row",4,"ngFor","ngForOf"],["class","mt-2 ms-3",4,"ngIf"],[1,"text-start","mt-3"],["for","surfaceFilter",1,"form-label","fw-bold","mb-1"],["class","form-check d-flex align-items-center gap-2 ms-3",4,"ngFor","ngForOf"],["for","tournamentTypeFilter",1,"form-label","fw-bold","mb-1"],["for","tournamentLevelFilter",1,"form-label","fw-bold","mb-1"],[1,"text-center","mt-3","d-flex","justify-content-center","gap-4"],[1,"link-button",3,"click"],[1,"form-check","filter-radio-row"],[1,"form-check-label","d-flex","align-items-center",3,"for"],["type","radio","name","dateFilter",1,"form-check-input","me-2",3,"ngModelChange","change","click","value","ngModel","id"],[1,"mt-2","ms-3"],["for","fromDate",1,"form-label"],["id","fromDate","type","date",1,"form-control",3,"ngModelChange","ngModel"],["for","toDate",1,"form-label","mt-2"],["id","toDate","type","date",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-check","d-flex","align-items-center","gap-2","ms-3"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"form-check-label","mb-0",3,"for"]],template:function(t,n){t&1&&(r(0,"div",0),f("accessibleClick",function(){return n.close()}),r(1,"div",1),f("click",function(a){return a.stopPropagation()}),r(2,"button",2),f("accessibleClick",function(){return n.close()}),c(3,"\xD7"),o(),r(4,"h5",3),c(5,"Filter Tournaments"),o(),g(6,"br"),r(7,"div",4)(8,"div",5)(9,"p",6),c(10,"Filter by Date:"),o(),v(11,he,4,6,"div",7)(12,fe,7,2,"div",8),o(),g(13,"hr"),r(14,"div",9)(15,"label",10),c(16,"Filter by Surface:"),o(),r(17,"div",9),v(18,ve,4,4,"div",11),o()()(),g(19,"hr"),r(20,"div",9)(21,"label",12),c(22,"Filter by Tournament Type:"),o(),r(23,"div",9),v(24,ge,4,4,"div",11),o()(),g(25,"hr"),r(26,"div",9)(27,"label",13),c(28,"Filter by Tournament Level:"),o(),r(29,"div",9),v(30,De,4,4,"div",11),o()(),r(31,"div",14)(32,"button",15),f("click",function(){return n.apply()}),c(33,"Apply"),o(),r(34,"button",15),f("click",function(){return n.reset()}),c(35,"Reset"),o()()()()),t&2&&(s(),m("onEscape",n.close),s(10),m("ngForOf",n.dateOptions),s(),m("ngIf",n.selectedDateOption==="custom"),s(6),m("ngForOf",n.surfaces),s(6),m("ngForOf",n.tournamentTypes),s(6),m("ngForOf",n.tournamentLevels))},dependencies:[A,k,L,V,ee,ie,te,ne,oe,se],encapsulation:2})};var N=class l{constructor(e){this.http=e}apiUrl=`${P.apiUrl}/tournamentevents`;getTournamentsByDate(e){return console.log(`\u{1F4E1} Calling${this.apiUrl}/summaries/by-date/${e} with:`,e),this.http.get(`${this.apiUrl}/summaries/by-date/${e}`)}getTournamentsByDateRange(e,t){let n=`${this.apiUrl}/filter-by-date-range?from=${e}&to=${t}`;return console.log("\u{1F4E1} Calling getTournamentsByDateRange with:",n),this.http.get(n)}getDateRange(){return this.http.get(`${this.apiUrl}/daterange`)}getAvailableDates(){return this.http.get(`${this.apiUrl}/available-dates`)}getTournamentEventsByDay(e){let t=`${P.apiUrl}/tournamenteventdays/by-date/${e}`;return this.http.get(t).pipe(B(n=>n.tournaments))}static \u0275fac=function(t){return new(t||l)(W(Z))};static \u0275prov=H({token:l,factory:l.\u0275fac,providedIn:"root"})};var _e=["dateInput"];function be(l,e){l&1&&(r(0,"span",18),c(1,"\u25CF"),o())}function Ie(l,e){if(l&1&&(r(0,"span"),c(1),o()),l&2){let t=u();s(),T(" ",t.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function Fe(l,e){if(l&1&&(r(0,"span"),c(1),o()),l&2){let t=u();s(),T(" ",t.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function ye(l,e){if(l&1){let t=D();r(0,"tr")(1,"td"),g(2,"span"),r(3,"span",19),f("click",function(){let i=p(t).$implicit,a=u();return h(a.openTournamentModal(i.tournamentEventId))}),c(4),o()(),r(5,"td"),c(6),o(),r(7,"td"),c(8),o(),r(9,"td"),c(10),o(),r(11,"td"),c(12),o(),r(13,"td"),c(14),o(),r(15,"td"),c(16),o()()}if(l&2){let t=e.$implicit,n=u();s(2),z("fi fi-",t.countryISO2==null?null:t.countryISO2.toLowerCase(),""),s(2),T(" ",n.decodeHtmlEntities(n.removeRomanSuffix(n.removeRomanSuffix(t.tournamentEventName)))," "),s(2),F(n.getLocalizedDateTime(t.matchDate)),s(2),F(t.tournamentLevel),s(2),T("",t.tournamentType," "),s(2),F(t.prize),s(2),F(t.surface),s(2),F(t.matches||0)}}function xe(l,e){if(l&1){let t=D();r(0,"app-tournament-filter-modal",20),f("filterApplied",function(i){p(t);let a=u();return h(a.onFilterApplied(i))})("resetFilter",function(){p(t);let i=u();return h(i.clearFilter())})("closed",function(){p(t);let i=u();return h(i.closeFilterModal())}),o()}if(l&2){let t=u();m("activeTournamentTypeIds",t.activeTournamentTypeIds)}}var me=class l{constructor(e,t,n){this.tournamentEventService=e;this.translate=t;this.appComponent=n}Math=Math;tournaments=[];filteredMatches=[];isFiltered=!1;filteredPage=1;currentDate=new Date("2022-01-01");isNextDisabled=!1;isPrevDisabled=!1;loading=!1;selectedDate=null;showDatepicker=!1;showFilterModal=!1;selectedPlayer=null;selectedTournament=null;sortField="tournament";sortDirection="asc";filterApplied=!1;activeDateFilter="all";activeFromDate=null;activeToDate=null;activeSurfaceIds=[1,2,3,4];activeTournamentTypeIds=[2,4];activeTournamentLevelIds=[1,2,3,4];filteredAvailableDates=[];showDateWarning=!1;currentDateString=this.formatDate(this.currentDate);noTournamentsForFilter=!1;showOutOfRangeModal=!1;minDate;maxDate;inputDebounceTimeout=null;availableDates=[];dateInputRef;onClickOutside(e){let t=e.target,n=t.closest(".datepicker-wrapper"),i=t.closest(".datepicker-toggle");!n&&!i&&(this.showDatepicker=!1)}ngOnInit(){this.tournamentEventService.getDateRange().subscribe({next:({minDate:e,maxDate:t})=>{this.minDate=new Date(e),this.maxDate=new Date(t),this.currentDate=this.maxDate,this.currentDateString=this.formatDateForInput(this.currentDate),this.tournamentEventService.getAvailableDates().subscribe({next:n=>{this.availableDates=n,this.loadTournamentsForDate(this.currentDate)},error:n=>{console.error("\u274C Failed to load availableDates:",n)}})},error:e=>{console.error("\u274C Failed to load match date range:",e)}}),document.addEventListener("keydown",this.handleEscapeKey.bind(this))}ngOnDestroy(){document.removeEventListener("keydown",this.handleEscapeKey.bind(this))}formatDate(e){return e.toISOString().split("T")[0].replace(/-/g,"")}scrollToTop(){let e=document.querySelector(".table-wrapper");e&&(e.scrollTop=0)}handleEscapeKey(e){e.key==="Escape"&&this.closeDateWarningModal()}loadTournamentsForDate(e){this.loading=!0;let t=this.correctDateIfOutOfBounds(e);this.currentDate=t,this.currentDateString=this.formatDateForInput(t),this.noTournamentsForFilter=!1,t.getTime()!==e.getTime()&&this.showDateOutOfRangeModal();let n=this.formatDate(t);this.tournamentEventService.getTournamentEventsByDay(n).subscribe({next:i=>{this.isFiltered&&(this.activeSurfaceIds?.length&&this.activeSurfaceIds.length<4&&(i=i.filter(a=>a.surfaceId!==void 0&&this.activeSurfaceIds.includes(a.surfaceId))),this.activeTournamentTypeIds?.length&&this.activeTournamentTypeIds.length<2&&(i=i.filter(a=>a.tournamentTypeId!==void 0&&this.activeTournamentTypeIds.includes(a.tournamentTypeId))),this.activeTournamentLevelIds?.length&&this.activeTournamentLevelIds.length<4&&(i=i.filter(a=>a.tournamentLevelId!==void 0&&this.activeTournamentLevelIds.includes(a.tournamentLevelId)))),this.tournaments=i,this.sortTournaments(),this.checkAdjacentDaysAvailability(t),this.loading=!1},error:i=>{console.error("\u274C Error loading matches:",i),this.tournaments=[],this.loading=!1,this.isPrevDisabled=!0,this.isNextDisabled=!0}})}sortTournaments(){this.tournaments.sort((e,t)=>{let n="",i="";this.sortField==="tournament"?(n=this.removeRomanSuffix(e.tournamentEventName||"").toLowerCase(),i=this.removeRomanSuffix(t.tournamentEventName||"").toLowerCase()):this.sortField==="date"&&(n=new Date(e.matchDate).getTime(),i=new Date(t.matchDate).getTime());let a=n<i?-1:n>i?1:0;return this.sortDirection==="asc"?a:-a})}toggleSort(e){this.sortField===e?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=e,this.sortDirection="asc"),this.sortTournaments()}onNativeDateChange(e){let t=e.target,n=new Date(t.value);if(isNaN(n.getTime()))return;let i=n.toISOString().split("T")[0];if(this.isFiltered&&this.filteredAvailableDates.length>0&&!this.filteredAvailableDates.includes(i)){this.showOutOfFilterRangeModal();let d=this.currentDate?this.formatDateForInput(this.currentDate):"";console.log("Resetting input to last valid date:",this.currentDate,d),this.currentDateString=d,this.dateInputRef?.nativeElement&&(this.dateInputRef.nativeElement.value=this.currentDateString);return}this.loadTournamentsForDate(n)}onDateInputChanged(e){let t=e.target;this.inputDebounceTimeout&&clearTimeout(this.inputDebounceTimeout),this.inputDebounceTimeout=setTimeout(()=>{let n=new Date(t.value);if(isNaN(n.getTime()))return;let i=n.toISOString().split("T")[0];if(this.isFiltered&&this.filteredAvailableDates.length>0&&!this.filteredAvailableDates.includes(i)){this.showOutOfFilterRangeModal();let d=this.formatDateForInput(this.currentDate);this.currentDateString=d,this.dateInputRef?.nativeElement&&(this.dateInputRef.nativeElement.value=d);return}if(!this.isFiltered){let a=this.correctDateIfOutOfBounds(n);if(a.getTime()!==n.getTime()){this.showDateOutOfRangeModal();let d=this.formatDateForInput(a);this.currentDate=a,this.currentDateString=d,this.dateInputRef?.nativeElement&&(this.dateInputRef.nativeElement.value=d),this.loadTournamentsForDate(a),this.checkAdjacentDaysAvailability(a);return}}this.loadTournamentsForDate(n)},500)}previousDay(){if(this.isFiltered&&this.filteredAvailableDates.length>0){let e=this.formatDateForInput(this.currentDate),t=this.filteredAvailableDates.findIndex(n=>n.trim()===e);if(console.log("\u{1F4CD} Filtered Dates:",this.filteredAvailableDates),console.log("\u{1F4CD} Current Date string:",e),console.log("\u{1F4CD} Index found:",t),t>0){let n=new Date(this.filteredAvailableDates[t-1].trim());this.currentDate=n,this.filteredPage=1,this.loadTournamentsForDate(n)}}else{let e=new Date(this.currentDate);e.setDate(e.getDate()-1),this.loadTournamentsForDate(e)}this.scrollToTop()}nextDay(){if(this.isFiltered&&this.filteredAvailableDates.length>0){let e=this.formatDateForInput(this.currentDate),t=this.filteredAvailableDates.findIndex(n=>n.trim()===e);if(console.log("\u{1F4CD} Filtered Dates:",this.filteredAvailableDates),console.log("\u{1F4CD} Current Date string:",e),console.log("\u{1F4CD} Index found:",t),t>=0&&t<this.filteredAvailableDates.length-1){let n=new Date(this.filteredAvailableDates[t+1].trim());this.currentDate=n,this.filteredPage=1,this.loadTournamentsForDate(n)}}else{let e=new Date(this.currentDate);e.setDate(e.getDate()+1),this.loadTournamentsForDate(e)}this.scrollToTop()}getLocalizedDateTime(e){let t=typeof e=="string"?new Date(e):e;if(isNaN(t.getTime()))return"";let n=b=>b.toString().padStart(2,"0"),i=n(t.getDate()),a=n(t.getMonth()+1),d=t.getFullYear(),y=n(t.getHours()),x=n(t.getMinutes());return`${i}.${a}.${d} ${y}:${x}`}formatOdds(e){return e==null||isNaN(e)?"":e.toFixed(2)}formatPercent(e){return e==null||isNaN(e)?"":(e*100).toFixed(0)+"%"}selectedTournamentEvent=null;openMatchModal(e){this.selectedTournamentEvent=e}closeMatchModal(){this.selectedTournamentEvent=null}openFilterModal(){this.showFilterModal=!0}closeFilterModal(){this.showFilterModal=!1}openTournamentModal(e){this.selectedTournament=e}closeTournamentModal(){this.selectedTournament=null}formatResult(e){if(!e||e.length!==2)return"";let t=e[0],n=e[1];return`${t} : ${n}`}removeRomanSuffix(e){return e.replace(/\s*(\([IVXLCDM]{1,4}\)|[IVXLCDM]{1,4})\s*$/,"").trim()}decodeHtmlEntities(e){let t=document.createElement("textarea");return t.innerHTML=e,t.value}onFilterApplied(e){console.log("\u{1F9EA} onFilterApplied (incoming):",e),e.option==="all"&&(!e.startDate||!e.endDate)&&(e.startDate=this.minDate.toISOString().split("T")[0],e.endDate=this.maxDate.toISOString().split("T")[0]);let t=new Date(e.startDate),n=new Date(e.endDate),i=t.toISOString().split("T")[0],a=n.toISOString().split("T")[0];this.activeDateFilter=e.option,this.activeFromDate=i,this.activeToDate=a,this.activeSurfaceIds=e.surfaceIds?.length?e.surfaceIds:[1,2,3,4],this.activeTournamentTypeIds=e.tournamentTypeIds?.length?e.tournamentTypeIds:[2,4],this.activeTournamentLevelIds=e.tournamentLevelIds?.length?e.tournamentLevelIds:[1,2,3,4];let d=this.activeSurfaceIds.length===4&&[1,2,3,4].every(_=>this.activeSurfaceIds.includes(_)),y=this.activeTournamentTypeIds.length===2&&[2,4].every(_=>this.activeTournamentTypeIds.includes(_)),x=this.activeTournamentLevelIds.length===4&&[1,2,3,4].every(_=>this.activeTournamentLevelIds.includes(_)),b=e.option==="all";if(this.isFiltered=!(b&&d&&y&&x),this.filterApplied=this.isFiltered,!this.isFiltered){this.filteredAvailableDates=[],this.filteredPage=1,this.noTournamentsForFilter=!1,this.currentDateString=this.formatDateForInput(this.currentDate),this.showFilterModal=!1,this.loadTournamentsForDate(this.currentDate);return}this.tournamentEventService.getAvailableDates().subscribe({next:_=>{let S=_.filter($=>$>=i&&$<=a);if(S.length===0){console.warn("\u26A0\uFE0F No tournaments found for selected range:",i,"to",a),this.tournaments=[],this.filteredAvailableDates=[],this.noTournamentsForFilter=!0,this.loading=!1,this.showFilterModal=!1;return}this.filteredAvailableDates=S;let ue=S[S.length-1];this.currentDate=new Date(ue),this.filteredPage=1,this.noTournamentsForFilter=!1,this.showFilterModal=!1,this.loading=!0,this.loadTournamentsForDate(this.currentDate)},error:_=>{console.error("\u274C Error fetching available dates:",_),this.tournaments=[],this.filteredAvailableDates=[],this.noTournamentsForFilter=!0,this.loading=!1,this.showFilterModal=!1}})}generateDateRange(e,t){let n=[],i=new Date(e),a=new Date(t);for(;i<=a;){let d=i.toISOString().split("T")[0];this.availableDates.includes(d)&&n.push(d),i.setDate(i.getDate()+1)}return n}clearFilter(){this.isFiltered=!1,this.filteredPage=1,this.loadTournamentsForDate(this.currentDate)}onFilterReset(){this.filterApplied=!1,this.activeDateFilter="all",this.activeFromDate=null,this.activeToDate=null,this.clearFilter()}isFilterDefault(){let e=this.activeSurfaceIds.length===4&&[1,2,3,4].every(a=>this.activeSurfaceIds.includes(a)),t=this.activeTournamentTypeIds.length===2&&[2,4].every(a=>this.activeTournamentTypeIds.includes(a)),n=this.activeTournamentLevelIds.length===4&&[1,2,3,4].every(a=>this.activeTournamentLevelIds.includes(a)),i=this.activeDateFilter==="all";return e&&t&&n&&i}correctDateIfOutOfBounds(e){return e<this.minDate?this.minDate:e>this.maxDate?this.maxDate:e}showDateOutOfRangeModal(){this.showDateWarning=!0,setTimeout(()=>this.closeDateWarningModal(),5e3)}closeDateWarningModal(){this.showDateWarning=!1}checkAdjacentDaysAvailability(e){let t=this.formatDateForInput(e);if(this.isFiltered&&this.filteredAvailableDates.length>0){let a=this.filteredAvailableDates.findIndex(d=>d===t);if(console.log("\u{1F4CD} Current Date string:",t),console.log("\u{1F4CD} Index found:",a),this.isPrevDisabled=a<=0,this.isNextDisabled=a===-1||a>=this.filteredAvailableDates.length-1,a===-1){let d=new Date(t).getTime(),y=this.filteredAvailableDates.find(b=>new Date(b).getTime()<d),x=this.filteredAvailableDates.find(b=>new Date(b).getTime()>d);this.isPrevDisabled=!y,this.isNextDisabled=!x}return}let n=new Date(e);n.setDate(e.getDate()-1);let i=new Date(e);i.setDate(e.getDate()+1),this.tournamentEventService.getTournamentEventsByDay(this.formatDate(n)).subscribe({next:a=>{this.isPrevDisabled=!a?.length},error:()=>{this.isPrevDisabled=!0}}),this.tournamentEventService.getTournamentEventsByDay(this.formatDate(i)).subscribe({next:a=>{this.isNextDisabled=!a?.length},error:()=>{this.isNextDisabled=!0}})}showOutOfFilterRangeModal(){this.showOutOfRangeModal=!0,setTimeout(()=>this.showOutOfRangeModal=!1,5e3)}formatDateForInput(e){return!e||isNaN(e.getTime())?(console.error("\u274C Invalid date passed to formatDateForInput:",e),"Invalid-Date"):e.toISOString().split("T")[0]}static \u0275fac=function(t){return new(t||l)(C(N),C(re),C(le))};static \u0275cmp=E({type:l,selectors:[["app-tournaments"]],viewQuery:function(t,n){if(t&1&&K(_e,5),t&2){let i;Y(i=q())&&(n.dateInputRef=i.first)}},hostBindings:function(t,n){t&1&&f("click",function(a){return n.onClickOutside(a)},!1,U)},inputs:{minDate:"minDate",maxDate:"maxDate"},decls:38,vars:12,consts:[["dateInput",""],[1,"tournamentEvents-page-wrapper"],[1,"date-nav-sticky","d-flex","align-items-center","justify-content-between","mt-3","px-2"],[1,"pagination-center-wrapper","mx-auto","d-flex","align-items-center","gap-3"],[1,"link-button",3,"click","disabled"],["src","assets/icons/left.svg","alt","Previous",1,"arrow-icon"],["type","date",1,"custom-date-input",3,"change","value","disabled"],["src","assets/icons/right.svg","alt","Next",1,"arrow-icon"],[1,"filter-button-wrapper"],[1,"link-button","d-flex","align-items-center","gap-2",3,"click"],["src","assets/icons/filter.svg","alt","Filter",1,"arrow-icon"],["class","badge bg-success ms-1",4,"ngIf"],[1,"tournamentEvent-table-wrapper"],[1,"tournamentEvent-table"],[3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"activeTournamentTypeIds","filterApplied","resetFilter","closed",4,"ngIf"],[1,"badge","bg-success","ms-1"],[1,"clickable-text",3,"click"],[3,"filterApplied","resetFilter","closed","activeTournamentTypeIds"]],template:function(t,n){if(t&1){let i=D();r(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),f("click",function(){return p(i),h(n.previousDay())}),g(4,"img",5),o(),r(5,"input",6,0),X(7,"date"),f("change",function(d){return p(i),h(n.onDateInputChanged(d))}),o(),r(8,"button",4),f("click",function(){return p(i),h(n.nextDay())}),g(9,"img",7),o()(),r(10,"div",8)(11,"button",9),f("click",function(){return p(i),h(n.openFilterModal())}),g(12,"img",10),c(13," Filter "),v(14,be,2,0,"span",11),o()()(),r(15,"div",12)(16,"table",13)(17,"thead")(18,"tr")(19,"th",14),f("click",function(){return p(i),h(n.toggleSort("tournament"))}),c(20," Name "),v(21,Ie,2,1,"span",15),o(),r(22,"th",14),f("click",function(){return p(i),h(n.toggleSort("date"))}),c(23," Date "),v(24,Fe,2,1,"span",15),o(),r(25,"th"),c(26,"Level"),o(),r(27,"th"),c(28,"Type"),o(),r(29,"th",14),f("click",function(){return p(i),h(n.toggleSort("prize"))}),c(30," Prize "),o(),r(31,"th"),c(32,"Surface"),o(),r(33,"th"),c(34,"Matches"),o()()(),r(35,"tbody"),v(36,ye,17,10,"tr",16),o()()(),v(37,xe,1,1,"app-tournament-filter-modal",17),o()}t&2&&(s(3),m("disabled",n.isPrevDisabled),s(2),m("value",G(7,9,n.formatDateForInput(n.currentDate),"yyyy-MM-dd"))("disabled",n.tournaments.length===0||n.isFiltered&&n.filteredAvailableDates.length===0),s(3),m("disabled",n.isNextDisabled),s(6),m("ngIf",n.isFiltered),s(7),m("ngIf",n.sortField==="tournament"),s(3),m("ngIf",n.sortField==="date"),s(12),m("ngForOf",n.tournaments),s(),m("ngIf",n.showFilterModal))},dependencies:[A,k,L,J,V,ae,R],encapsulation:2})};export{me as TournamentEventsComponent};
